<link rel="stylesheet" href="{{ url_for('static', filename='cards_abertos.css') }}">

<section class="cards-abertos-container" id="cards-abertos-container">
  {% if chamados_abertos %}
    {% for chamado in chamados_abertos %}
      <!-- Card Chamado -->
      <article class="chamado-card"
               onclick="abrirModalChamado({{ chamado.id }})"
               id="card-{{ chamado.id }}"
               aria-labelledby="titulo-chamado-{{ chamado.id }}">
        <header class="chamado-card-header">
          <h3 class="chamado-id" id="titulo-chamado-{{ chamado.id }}">#{{ chamado.id }}</h3>
          <span class="chamado-status {{ chamado.status | lower | replace(' ', '-') }}">{{ chamado.status }}</span>
        </header>

        <dl class="chamado-card-main">
          <dt>Cliente:</dt>
          <dd>{{ chamado.cliente }}</dd>

          <dt>Empresa:</dt>
          <dd>{{ chamado.empresa }}</dd>

          <dt>Data:</dt>
          <dd>{{ chamado.data }}</dd>

          <dt>Prioridade:</dt>
          <dd>
            <span class="prioridade prioridade-{{ chamado.prioridade | lower }}">{{ chamado.prioridade }}</span>
          </dd>
        </dl>
      </article>

      <!-- Modal Chamado -->
      <section class="modal-chamado"
               id="modal-chamado-{{ chamado.id }}"
               style="display: none;"
               role="dialog"
               aria-modal="true"
               aria-labelledby="modal-titulo-{{ chamado.id }}">
        <div class="modal-content">
          <header class="modal-header">
            <h2 class="modal-titulo" id="modal-titulo-{{ chamado.id }}">
              Chamado #{{ chamado.id }} - {{ chamado.status }}
            </h2>
            <button class="close-modal" onclick="fecharModalChamado({{ chamado.id }})" aria-label="Fechar modal">
              &times;
            </button>
          </header>

          <dl class="lista-info-modal">
            <dt>Responsável:</dt><dd>{{ chamado.responsavel_atendimento }}</dd>
            <dt>Data:</dt><dd>{{ chamado.data }} {{ chamado.horario }}</dd>
            <dt>Cliente:</dt><dd>{{ chamado.cliente }}</dd>
            <dt>Empresa:</dt><dd>{{ chamado.empresa }}</dd>
            <dt>Tipo de Máquina:</dt><dd>{{ chamado.tipo_maquina }}</dd>
            <dt>Porta SSH:</dt><dd>{{ chamado.porta_ssh }}</dd>
            <dt>Prioridade:</dt><dd>{{ chamado.prioridade }}</dd>
            <dt>Origem:</dt><dd>{{ chamado.origem }}</dd>
            <dt>Responsável pela ação:</dt><dd>{{ chamado.responsavel_acao }}</dd>
            <dt>Relato:</dt><dd>{{ chamado.relato }}</dd>
            <dt>Descrição da ação:</dt><dd>{{ chamado.descricao_acao }}</dd>
          </dl>

          <!-- SPA: usar carregarConteudo para evitar reload -->
          <button class="btn-editar-modal" onclick="carregarConteudo('editar/{{ chamado.id }}')">
            ✏️ Editar Chamado
          </button>
        </div>
      </section>
    {% endfor %}

    <!-- Overlay para modal -->
    <div class="modal-overlay" id="modal-overlay" style="display: none;"></div>
  {% else %}
    <p style="text-align: center; font-size: 1.2rem; color: #ccc;">Nenhum chamado aberto.</p>
  {% endif %}
</section>
