<h2>Editar Chamado #{{ chamado.id }}</h2>

<form class="form-card" method="POST" action="/editar/{{ chamado.id }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

    <!-- Respons√°vel pelo atendimento -->
    <label for="responsavel_atendimento">Respons√°vel pelo Atendimento:</label>
    <select id="responsavel_atendimento" name="responsavel_atendimento" required>
        {% for user in lista_usuarios %}
            <option value="{{ user }}" {% if user == chamado.responsavel_atendimento %}selected{% endif %}>{{ user }}</option>
        {% endfor %}
    </select>

    <!-- Data e hor√°rio -->
    <label for="data">Data:</label>
    <input id="data" name="data" type="date" value="{{ chamado.data }}" required>

    <label for="horario">Hor√°rio:</label>
    <input id="horario" name="horario" type="time" value="{{ chamado.horario }}" required>

    <!-- Dados do cliente -->
    <label for="cliente">Nome do Cliente:</label>
    <input id="cliente" name="cliente" type="text" value="{{ chamado.cliente }}" required>

    <label for="empresa">Empresa:</label>
    <select id="empresa" name="empresa" required>
        {% for empresa in lista_empresas %}
            <option value="{{ empresa }}" {% if empresa == chamado.empresa %}selected{% endif %}>{{ empresa }}</option>
        {% endfor %}
    </select>

    <label for="porta_ssh">Porta SSH da M√°quina:</label>
    <input id="porta_ssh" name="porta_ssh" type="text" value="{{ chamado.porta_ssh }}"/>

    <label for="tipo_maquina">Tipo da M√°quina:</label>
    <select id="tipo_maquina" name="tipo_maquina" required>
        {% for maquina in lista_maquinas %}
            <option value="{{ maquina }}" {% if maquina == chamado.tipo_maquina %}selected{% endif %}>{{ maquina }}</option>
        {% endfor %}
    </select>

    <!-- Relato -->
    <label for="relato">Relato / Solicita√ß√£o do Cliente:</label>
    <textarea id="relato" name="relato" rows="3">{{ chamado.relato }}</textarea>

    <!-- Prioridade -->
    <label for="prioridade">Prioridade:</label>
    <select id="prioridade" name="prioridade" required>
        {% for nivel in ["Baixa", "M√©dia", "Alta", "Cr√≠tica"] %}
            <option value="{{ nivel }}" {% if chamado.prioridade == nivel %}selected{% endif %}>{{ nivel }}</option>
        {% endfor %}
    </select>

    <!-- Origem -->
    <label for="origem">Origem do Caso:</label>
    <select id="origem" name="origem" required>
        <option value="" disabled>Selecione a origem do problema</option>
        {% for nome in lista_origens %}
            <option value="{{ nome }}" {% if nome == chamado.origem %}selected{% endif %}>{{ nome }}</option>
        {% endfor %}
    </select>

    <!-- Respons√°vel pela a√ß√£o -->
    <label for="responsavel_acao">Respons√°vel pela A√ß√£o:</label>
    <select id="responsavel_acao" name="responsavel_acao">
        {% for user in lista_usuarios %}
            <option value="{{ user }}" {% if user == chamado.responsavel_acao %}selected{% endif %}>{{ user }}</option>
        {% endfor %}
    </select>

    <!-- A√ß√£o e status -->
    <label for="descricao_acao">A√ß√£o Realizada / Descri√ß√£o:</label>
    <textarea id="descricao_acao" name="descricao_acao" rows="3">{{ chamado.descricao_acao }}</textarea>

    <label for="status">Status do Caso:</label>
    <select id="status" name="status" required>
        {% for s in ["Aberto", "Em andamento", "Resolvido", "Fechado"] %}
            <option value="{{ s }}" {% if chamado.status == s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
    </select>

    <button type="submit">üíæ Salvar Altera√ß√µes</button>
</form>

<!-- Hist√≥rico -->
<section class="historico-logs">
    <h3>üìú Hist√≥rico de Altera√ß√µes</h3>
    {% if historico_logs %}
        <ul class="log-lista">
            {% for acao, data_hora, usuario in historico_logs %}
                <li><strong>{{ usuario }}</strong> - {{ acao }} em {{ data_hora.strftime('%d/%m/%Y %H:%M') }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Nenhuma altera√ß√£o registrada para este chamado.</p>
    {% endif %}
</section>

<!-- Toast SPA -->
{% with mensagens = get_flashed_messages() %}
    {% if mensagens %}
        <div class="toast" id="toast">
            {{ mensagens[0] }}
        </div>
    {% endif %}
{% endwith %}
