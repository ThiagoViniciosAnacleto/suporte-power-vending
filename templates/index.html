<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Central de Suporte - Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container-principal">

    <!-- Topo fixo -->
    <header class="topbar">
        <div class="topbar-left">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo Power Vending" class="logo-pv">
        </div>

        <div class="topbar-actions">
            <button class="btn-header">NotificaÃ§ÃµesðŸ””</button>
            <button class="btn-header" id="toggle-darkmode">ðŸŒ™ Modo</button>
            <form action="/logout" method="get" style="display:inline;">
                <button type="submit" class="btn-header btn-sair">Sair</button>
            </form>
        </div>

        <div class="topbar-user">
            <img src="{{ url_for('static', filename='img/avatar.png') }}" alt="Avatar" class="usuario-avatar">
            <div class="usuario-dados">
                <span class="usuario-nome">{{ session["usuario"] }}</span>
                <span class="usuario-cargo">
                {% if session["is_admin"] == 1 %}Administrador
                {% elif session["is_admin"] == 2 %}TÃ©cnico
                {% else %}UsuÃ¡rio
                {% endif %}
                </span>
            </div>
        </div>
    </header>

    <!-- Menu lateral -->
    <aside class="home-nav">
        <ul>

        <li><button onclick="carregarConteudo('/conteudo/chamados_abertos')">ðŸ“‚ Chamados Abertos</button></li>
        
        {% if session["is_admin"] in [1, 2] %}
        <li><button onclick="carregarConteudo('/conteudo/novo_chamado')">âž• Abrir Novo Chamado</button></li>
        {% endif %}
        <li><button onclick="carregarConteudo('/conteudo/lista_chamados')">ðŸ“‚ Lista de Chamados</button></li>
        <li><button onclick="carregarConteudo('/conteudo/dashboard')">ðŸ“Š Dashboard</button></li>

        {% if session["is_admin"] in [1, 2] %}
        <li><button onclick="carregarConteudo('/conteudo/cadastrar_empresa')">âž• Cadastrar Empresa</button></li>
        <li><button onclick="carregarConteudo('/conteudo/cadastrar_maquina')">âž• Cadastrar Novo Tipo de MÃ¡quina</button></li>
        {% endif %}

        {% if session["is_admin"] == 1 %}
        <li><button onclick="carregarConteudo('/conteudo/cadastrar_usuario')">âž• Cadastrar Novo UsuÃ¡rio</button></li>
        <li><button onclick="carregarConteudo('/conteudo/editar_privilegios')">âž• Editar PrivilÃ©gios</button></li>
        <li><button onclick="carregarConteudo('/conteudo/cadastrar_recorrente')">âž• Cadastrar Chamado Recorrente</button></li>
        {% endif %}
        </ul>
    </aside>

    <!-- ConteÃºdo dinÃ¢mico -->
    <main id="conteudo-dinamico">
        <!-- ConteÃºdo inicial: cards de chamados abertos -->
        {% include "partials/cards_abertos.html" %}
    </main>
    </div>

    <!-- Flash message -->
    {% with mensagens = get_flashed_messages() %}
    {% if mensagens %}
        <div class="toast" id="toast">
        {{ mensagens[0] }}
        </div>
    {% endif %}
    {% endwith %}

    <script>
    function carregarConteudo(url) {
        fetch(url)
        .then(res => res.text())
        .then(html => {
            document.getElementById("conteudo-dinamico").innerHTML = html;
        })
        .catch(() => {
            document.getElementById("conteudo-dinamico").innerHTML = "<p>Erro ao carregar conteÃºdo.</p>";
        });
    }
    </script>

    <script src="{{ url_for('static', filename='scripts.js') }}"></script>
</body>
</html>
